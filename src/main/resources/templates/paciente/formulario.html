<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">

<head>
    <meta charset="UTF-8">
    <title th:text="${pacienteId != null} ? 'Editar Paciente' : 'Registrar Nuevo Paciente'">Paciente</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>

<body class="bg-gray-100 text-gray-800 min-h-screen flex items-center justify-center p-4">

    <div class="w-full max-w-xl bg-white rounded-xl shadow p-8">

        <h2 class="text-2xl font-bold text-center text-emerald-700 mb-6"
            th:text="${pacienteId != null} ? 'Editar Paciente' : 'Registrar Nuevo Paciente'">
        </h2>

        <div th:if="${errorMensaje}" class="text-red-600 text-sm font-semibold text-center mb-4"
             th:text="${errorMensaje}">
        </div>

        <form th:action="@{${pacienteId} != null ? '/pacientes/actualizar/' + ${pacienteId} : '/pacientes/guardar'}"
              th:object="${pacienteDTO}" method="post">

            <!-- Nombre -->
            <div class="mb-4">
                <label class="block text-sm font-medium mb-1">Nombre:</label>
                <input type="text" th:field="*{nombre}" class="w-full border border-gray-300 rounded px-3 py-2" required />
                <div class="text-red-600 text-sm mt-1" th:if="${#fields.hasErrors('nombre')}" th:errors="*{nombre}"></div>
            </div>

            <!-- Número de Identificación -->
            <div class="mb-4">
                <label class="block text-sm font-medium mb-1">Número de Identificación:</label>
                <input type="text" th:field="*{numeroIdentificacion}" class="w-full border border-gray-300 rounded px-3 py-2" required />
                <div class="text-red-600 text-sm mt-1" th:if="${#fields.hasErrors('numeroIdentificacion')}" th:errors="*{numeroIdentificacion}"></div>
            </div>

            <!-- Fecha de Nacimiento -->
            <div class="mb-4">
                <label class="block text-sm font-medium mb-1">Fecha de Nacimiento:</label>
                <input type="date" th:field="*{fechaNacimiento}" class="w-full border border-gray-300 rounded px-3 py-2" required />
                <div class="text-red-600 text-sm mt-1" th:if="${#fields.hasErrors('fechaNacimiento')}" th:errors="*{fechaNacimiento}"></div>
            </div>

            <!-- Teléfono -->
            <div class="mb-4">
                <label class="block text-sm font-medium mb-1">Teléfono:</label>
                <input type="text" th:field="*{telefono}" class="w-full border border-gray-300 rounded px-3 py-2" required />
                <div class="text-red-600 text-sm mt-1" th:if="${#fields.hasErrors('telefono')}" th:errors="*{telefono}"></div>
            </div>

            <!-- Dirección -->
            <div class="mb-4">
                <label class="block text-sm font-medium mb-1">Dirección:</label>
                <input type="text" th:field="*{direccion}" class="w-full border border-gray-300 rounded px-3 py-2" required />
                <div class="text-red-600 text-sm mt-1" th:if="${#fields.hasErrors('direccion')}" th:errors="*{direccion}"></div>
            </div>

            <!-- Email -->
            <div class="mb-4">
                <label class="block text-sm font-medium mb-1">Email:</label>
                <input type="email" th:field="*{email}" class="w-full border border-gray-300 rounded px-3 py-2" required />
                <div class="text-red-600 text-sm mt-1" th:if="${#fields.hasErrors('email')}" th:errors="*{email}"></div>
            </div>

            <!-- Usuario -->
            <div class="mb-4">
                <label class="block text-sm font-medium mb-1">Usuario:</label>
                <input type="text" th:field="*{usuario}" class="w-full border border-gray-300 rounded px-3 py-2" required />
                <div class="text-red-600 text-sm mt-1" th:if="${#fields.hasErrors('usuario')}" th:errors="*{usuario}"></div>
            </div>

            <!-- Contraseña -->
            <div class="mb-4">
                <label class="block text-sm font-medium mb-1">Contraseña:</label>
                <input type="password" th:field="*{password}" class="w-full border border-gray-300 rounded px-3 py-2" required />
                <div class="text-red-600 text-sm mt-1" th:if="${#fields.hasErrors('password')}" th:errors="*{password}"></div>
            </div>

            <!-- Alergias -->
            <div class="mb-4 flex items-center gap-2">
                <input type="checkbox" th:field="*{tieneAlergias}" id="alergiasCheck"
                       class="h-4 w-4 text-emerald-600 border-gray-300 rounded"
                       onchange="document.getElementById('alergiasSelect').classList.toggle('hidden', !this.checked)">
                <label for="alergiasCheck" class="text-sm font-medium">¿Tiene Alergias?</label>
            </div>

            <div class="mb-6" id="alergiasSelect" th:classappend="${pacienteDTO.tieneAlergias == false} ? 'hidden' : ''">
			    <label class="block text-sm font-medium mb-1">Alergias:</label>
			    <select th:field="*{alergiaIds}" multiple
			            class="w-full border border-gray-300 rounded px-3 py-2">
			        <option th:each="alergia : ${alergiasDisponibles}"
			                th:value="${alergia.id}"
			                th:text="${alergia.nombre}"
			                th:selected="${pacienteDTO.alergiaIds != null} ? ${pacienteDTO.alergiaIds.contains(alergia.id)} : false">
			        </option>
			    </select>
			    <div class="text-red-600 text-sm mt-1" th:if="${#fields.hasErrors('alergiaIds')}" th:errors="*{alergiaIds}"></div>
			</div>


            <!-- Botones -->
            <div class="flex justify-between">
                <button type="submit"
                        class="bg-emerald-600 hover:bg-emerald-700 text-white font-semibold px-5 py-2 rounded">
                    Guardar
                </button>
                <a th:href="@{/pacientes}" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold px-5 py-2 rounded">
                    Cancelar
                </a>
            </div>

        </form>
    </div>

</body>
</html>
