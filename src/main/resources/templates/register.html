<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">

<head>
    <meta charset="UTF-8">
    <title>Registro de Paciente</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>

<body class="bg-gray-100 text-gray-800 min-h-screen flex items-center justify-center p-4">

    <div class="w-full max-w-xl bg-white rounded-xl shadow p-8">

        <h2 class="text-2xl font-bold text-center text-emerald-700 mb-6">Registro de Paciente</h2>

        <div th:if="${errorMensaje}" class="text-red-600 text-sm font-semibold text-center mb-4"
             th:text="${errorMensaje}"></div>

        <!-- Formulario apuntando a registro externo -->
        <form th:action="@{/registro/paciente}" th:object="${pacienteDTO}" method="post">

            <!-- Nombre -->
            <div class="mb-4">
                <label class="block text-sm font-medium mb-1">Nombre:</label>
                <input type="text" th:field="*{nombre}" class="w-full border border-gray-300 rounded px-3 py-2" required />
            </div>

            <!-- Número de Identificación -->
            <div class="mb-4">
                <label class="block text-sm font-medium mb-1">Número de Identificación:</label>
                <input type="text" th:field="*{numeroIdentificacion}" class="w-full border border-gray-300 rounded px-3 py-2" required />
            </div>

            <!-- Fecha de Nacimiento -->
            <div class="mb-4">
                <label class="block text-sm font-medium mb-1">Fecha de Nacimiento:</label>
                <input type="date" th:field="*{fechaNacimiento}" class="w-full border border-gray-300 rounded px-3 py-2" required />
            </div>

            <!-- Teléfono -->
            <div class="mb-4">
                <label class="block text-sm font-medium mb-1">Teléfono:</label>
                <input type="text" th:field="*{telefono}" class="w-full border border-gray-300 rounded px-3 py-2" required />
            </div>

            <!-- Dirección -->
            <div class="mb-4">
                <label class="block text-sm font-medium mb-1">Dirección:</label>
                <input type="text" th:field="*{direccion}" class="w-full border border-gray-300 rounded px-3 py-2" required />
            </div>

            <!-- Email -->
            <div class="mb-4">
                <label class="block text-sm font-medium mb-1">Email:</label>
                <input type="email" th:field="*{email}" class="w-full border border-gray-300 rounded px-3 py-2" required />
            </div>

            <!-- Usuario -->
            <div class="mb-4">
                <label class="block text-sm font-medium mb-1">Usuario:</label>
                <input type="text" th:field="*{usuario}" class="w-full border border-gray-300 rounded px-3 py-2" required />
            </div>

            <!-- Contraseña -->
            <div class="mb-4">
                <label class="block text-sm font-medium mb-1">Contraseña:</label>
                <input type="password" th:field="*{password}" class="w-full border border-gray-300 rounded px-3 py-2" required />
            </div>

            <!-- Alergias -->
            <div class="mb-4 flex items-center gap-2">
                <input type="checkbox" th:field="*{tieneAlergias}" id="alergiasCheck"
                       class="h-4 w-4 text-emerald-600 border-gray-300 rounded"
                       onchange="document.getElementById('alergiasSelect').classList.toggle('hidden', !this.checked)">
                <label for="alergiasCheck" class="text-sm font-medium">¿Tiene Alergias?</label>
            </div>

            <div class="mb-6" id="alergiasSelect" th:classappend="${pacienteDTO.tieneAlergias == false} ? 'hidden' : ''">
                <label class="block text-sm font-medium mb-1">Alergias:</label>
                <select th:field="*{alergiaIds}" multiple
                        class="w-full border border-gray-300 rounded px-3 py-2">
                    <option th:each="alergia : ${alergiasDisponibles}"
                            th:value="${alergia.id}"
                            th:text="${alergia.nombre}"></option>
                </select>
            </div>

            <!-- Hidden para indicar registro externo -->
            <input type="hidden" th:field="*{registroExterno}" th:value="true"/>

            <!-- Botón Guardar -->
            <div class="flex justify-between">
                <button type="submit"
                        class="bg-emerald-600 hover:bg-emerald-700 text-white font-semibold px-5 py-2 rounded">
                    Registrarse
                </button>
                <a th:href="@{/login}" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold px-5 py-2 rounded">
                    Volver al login
                </a>
            </div>
        </form>
    </div>
</body>
</html>
